# MySQL 数据库基础运维

> 主要关注`.zip`格式的免安装版本MySQL数据库

-----------------------------------------------------------------

## Install

1. 初始化  
    `mysqld --initialize --console`  

    记录临时密码  

2. 编辑配置文件
    - 注意  
        **！！！配置文件路径需要与服务安装路径一致！！！**
    - 配置文件结构  
        [client]：客户端相关配置  
        [mysql]：MySQL命令行工具相关配置  
        [mysqld]：MySQL服务器核心配置  
        [mysqldump]：数据备份工具相关配置  
        [innodb]：InnoDB存储引擎相关配置  
    - `my.ini`常用模板

        ```ini
        # temp_password = 2k6&javj9t/Z

        [mysqld]
        # 设置MySQL安装目录（替换为你的解压路径）
        basedir=D:\mysql-8.4.7
        # 设置MySQL数据存储目录
        datadir=D:\mysql-8.4.7\data
        # 设置端口号（默认3306，若被占用可修改为3307等）
        port=3637
        # 设置字符集（默认UTF-8，支持中文）
        character-set-server=utf8mb4
        # 设置默认存储引擎
        default-storage-engine=INNODB
        # 允许最大连接数
        max_connections=100
        # 跳过密码验证（初始化时使用，后续需关闭）
        ; skip-grant-tables
        
        [mysql]
        # MySQL客户端字符集
        default-character-set=utf8mb4
        
        [client]
        # 客户端连接端口
        port=3637
        # 客户端字符集
        default-character-set=utf8mb4

        ```

    - `my.ini`配置标准示范

        ```ini
        # ========================
        # [client] 客户端连接配置
        # ========================
        [client]
        # 客户端连接的默认端口号（建议与服务器端保持一致）
        port=3306

        # 客户端默认字符集（确保与服务器端一致，避免乱码）
        default-character-set=utf8mb4

        # ========================
        # [mysql] 命令行工具配置
        # ========================
        [mysql]
        # 客户端连接时默认使用的字符集
        default-character-set=utf8mb4

        # 禁用自动重新哈希（提高连接效率）
        no-auto-rehash

        # ========================
        # [mysqld] 服务器核心配置
        # ========================

        [mysqld]
        # ========================
        # 基础路径设置
        # ========================
        # MySQL 安装目录（请替换为您的实际安装路径）
        basedir=C:/Program Files/MySQL/MySQL Server 8.0

        # MySQL 数据目录（请替换为您的实际数据存储路径）
        # 注意：需要先创建此目录，并确保 MySQL 服务有读写权限
        datadir=C:/ProgramData/MySQL/MySQL Server 8.0/Data

        # 
        # 网络与连接相关
        # 
        # 服务器监听的端口号（建议修改默认端口以提高安全性）
        port=3306

        # 绑定地址（0.0.0.0 表示监听所有网络接口）
        bind-address=0.0.0.0

        # 允许的最大连接数（根据服务器资源调整，建议 100-500）
        max_connections=200

        # 允许连接失败的最大次数（防止暴力破解）
        max_connect_errors=100

        # 会话超时时间（秒），交互式连接超时
        interactive_timeout=28800

        # 非交互式连接超时（秒）
        wait_timeout=28800

        #
        # 字符集与排序规则设置
        #
        # 服务器默认字符集（推荐 utf8mb4，支持完整 Unicode 和表情符号）
        character-set-server=utf8mb4

        # 服务器默认排序规则（与字符集匹配）
        collation-server=utf8mb4_unicode_ci

        # 服务器默认存储引擎（InnoDB 是默认且推荐的存储引擎）
        default-storage-engine=INNODB

        #
        # InnoDB 存储引擎优化
        #
        # InnoDB 缓冲池大小（建议设为物理内存的 50%-70%，单位 G）
        innodb_buffer_pool_size=2G

        # InnoDB 日志文件大小（建议 1/4-1/2 的缓冲池大小，单位 M）
        innodb_log_file_size=512M

        # 事务日志刷新策略（0=由操作系统控制，1=每次提交刷新，2=每秒刷新）
        innodb_flush_log_at_trx_commit=2

        # InnoDB 事务日志文件数量
        innodb_log_files_in_group=2

        # InnoDB 线程池大小（根据 CPU 核心数调整，建议 8-16）
        innodb_thread_concurrency=0

        #
        # 安全与性能相关设置
        #
        # 跳过 DNS 解析（提高连接速度，但需确保客户端 IP 已知）
        skip-name-resolve

        # 允许远程登录（如果需要，建议配合防火墙设置）
        # bind-address=0.0.0.0

        # 跳过授权表（用于紧急修复，正常运行时应设为 OFF）
        skip-grant-tables=OFF

        #
        # 日志设置
        #
        # 错误日志文件路径
        log-error=C:/ProgramData/MySQL/MySQL Server 8.0/Data/mysql_error.log

        # 二进制日志（用于主从复制和数据恢复）
        # log-bin=C:/ProgramData/MySQL/MySQL Server 8.0/Data/mysql-bin

        # 慢查询日志（记录执行时间超过 long_query_time 的查询）
        # log-slow-queries=C:/ProgramData/MySQL/MySQL Server 8.0/Data/mysql-slow.log

        # 慢查询阈值（秒，建议 1-2 秒）
        long_query_time=2

        # 记录未使用索引的慢查询
        log-queries-not-using-indexes

        #
        # 其他优化设置
        #
        # 临时表最大大小（超过此值将写入磁盘）
        tmp_table_size=64M

        # 内存表最大大小
        max_heap_table_size=64M

        # 表缓存大小（根据数据量和并发调整）
        table_open_cache=400

        # 查询缓存（MySQL 8.0 默认已禁用，建议不使用）
        query_cache_type=0
        query_cache_size=0

        # 事务隔离级别（推荐 REPEATABLE READ）
        transaction_isolation=REPEATABLE-READ

        #
        # 服务器 ID（用于主从复制）
        #
        # server-id=1

        # ========================
        # 注意事项
        # ========================
        # 1. 请确保 datadir 目录存在，并且 MySQL 服务账户有读写权限
        # 2. 修改配置后需要重新初始化数据库并注册服务
        # 3. 推荐使用 utf8mb4 字符集，避免中文和表情符号乱码
        # 4. 根据实际服务器配置调整内存相关参数
        # 5. 生产环境建议设置 root 用户密码并修改默认端口

        ```

3. 安装服务  
    - 命令  
    `mysqld --install MySQL_ServiceName`  
    - 可选参数  

    ```markdown
    1. 安装**自动**类型服务：`--install` [服务名]
    2. 安装**手动**类型服务：`--install-manual` [服务名]
    3. 卸载服务：`--remove` [服务名]
    4. 读取指定配置文件：`--defaults-file="YourConfig.ini_PATH"`
    5. 配置开机自启动: `sc config MySQL_ServiceName start= auto`
    ```

4. 启动使用  
   - 命令  
   `net start MySQL_ServiceName`  
   `net stop MySQL_ServiceName`  

## Use

1. 登录  
   - 命令
   `mysql -u root -p`
   - 参数

    ```markdown
    1. -u 用户名
    2. -p 密码
    3. -h 主机(Remote Host)
    4. -P 端口
    5. -h 帮助
    ```
